"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/webRTC/socket";
exports.ids = ["pages/api/webRTC/socket"];
exports.modules = {

/***/ "socket.io":
/*!****************************!*\
  !*** external "socket.io" ***!
  \****************************/
/***/ ((module) => {

module.exports = import("socket.io");;

/***/ }),

/***/ "(api)/./pages/api/webRTC/socket.tsx":
/*!*************************************!*\
  !*** ./pages/api/webRTC/socket.tsx ***!
  \*************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var socket_io__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! socket.io */ \"socket.io\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([socket_io__WEBPACK_IMPORTED_MODULE_0__]);\nsocket_io__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// import { Server } from \"socket.io\";\n\nconst SocketHandler = (_, res)=>{\n    if (res.socket.server.io) {\n        console.log(\"Socket is already attached\");\n        return res.end();\n    }\n    const io = new socket_io__WEBPACK_IMPORTED_MODULE_0__.Server(res.socket.server);\n    res.socket.server.io = io;\n    io.on(\"connection\", (socket)=>{\n        console.log(`User Connected : ${socket.id}`);\n        //peer가 room join 버튼을 눌렀을 경우 클라이언트에서 join이 트리거 되어 서버에 전달\n        socket.on(\"join\", (roomName)=>{\n            console.log(\"[get event]\");\n            const { rooms  } = io.sockets.adapter;\n            const room = rooms.get(roomName);\n            //방이 없는 경우\n            if (room === undefined) {\n                console.log(\"[emit create]\");\n                socket.join(roomName);\n                socket.emit(\"created\");\n            } else if (room.size === 1) {\n                //방에 한 명만 있을 경우\n                console.log(\"[emit joined]\");\n                socket.join(roomName);\n                socket.emit(\"joined\");\n            } else {\n                //방에 두명인 경우 (full)\n                console.log(\"[emit full]\");\n                socket.emit(\"full\");\n            }\n            console.log(\"room info : \", rooms);\n        });\n        //방에 참여한 사람이 connection 준비가 되면 ready가 트리거 됨\n        socket.on(\"ready\", (roomName)=>{\n            console.log(\"[emit ready]\");\n            socket.broadcast.to(roomName).emit(\"ready\");\n        });\n        //서버가 room의 peer로부터 \"icecandidate\"를 받을 때 트리거\n        socket.on(\"ice-candidate\", (candidate, roomName)=>{\n            console.log(\"[emit ice-candidate]\");\n            socket.broadcast.to(roomName).emit(\"ice-candidate\", candidate); // room에 있는 다른 peer에게 \"candidate\" emit\n        });\n        //서버가 room에 있는 peer로부터 \"offer\"를 받을 때 트리거\n        socket.on(\"offer\", (offer, roomName)=>{\n            console.log(\"[emit offer]\");\n            socket.broadcast.to(roomName).emit(\"offer\", offer); // room에 있는 다른 peer에게 \"offer\" emit\n        });\n        //서버가 room에 있는 peer로부터 \"answer\"를 받을 때 트리거\n        socket.on(\"answer\", (answer, roomName)=>{\n            console.log(\"[emit answer]\");\n            socket.broadcast.to(roomName).emit(\"answer\", answer); // room에 있는 다른 peer에게 \"answer\" emit\n        });\n        //서버가 room에 있는 peer로부터 \"leave\"를 받을 때 트리거\n        socket.on(\"leave\", (roomName)=>{\n            console.log(\"[emit leave]\", roomName);\n            socket.leave(roomName);\n            socket.broadcast.to(roomName).emit(\"leave\"); // room에 있는 다른 peer에게 \"leave\" emit\n        });\n    });\n    return res.end();\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SocketHandler);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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WyJ3ZWJwYWNrOi8vY2FudmFzLWNvbXBvbmVudC8uL3BhZ2VzL2FwaS93ZWJSVEMvc29ja2V0LnRzeD8wMjc5Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCB7IFNlcnZlciB9IGZyb20gXCJzb2NrZXQuaW9cIjtcblxuaW1wb3J0IHsgU2VydmVyIGFzIE5ldFNlcnZlciwgU29ja2V0IH0gZnJvbSBcIm5ldFwiO1xuaW1wb3J0IHsgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSBcIm5leHRcIjtcbmltcG9ydCB7IFNlcnZlciBhcyBTb2NrZXRJT1NlcnZlciB9IGZyb20gXCJzb2NrZXQuaW9cIjtcblxudHlwZSBOZXh0QXBpUmVzcG9uc2VTZXJ2ZXJJTyA9IE5leHRBcGlSZXNwb25zZSAmIHtcbiAgc29ja2V0OiBTb2NrZXQgJiB7XG4gICAgc2VydmVyOiBOZXRTZXJ2ZXIgJiB7XG4gICAgICBpbzogU29ja2V0SU9TZXJ2ZXI7XG4gICAgfTtcbiAgfTtcbn07XG5cbmNvbnN0IFNvY2tldEhhbmRsZXIgPSAoXywgcmVzOiBOZXh0QXBpUmVzcG9uc2VTZXJ2ZXJJTyk6IGFueSA9PiB7XG4gIGlmIChyZXMuc29ja2V0LnNlcnZlci5pbykge1xuICAgIGNvbnNvbGUubG9nKFwiU29ja2V0IGlzIGFscmVhZHkgYXR0YWNoZWRcIik7XG4gICAgcmV0dXJuIHJlcy5lbmQoKTtcbiAgfVxuXG4gIGNvbnN0IGlvID0gbmV3IFNvY2tldElPU2VydmVyKHJlcy5zb2NrZXQuc2VydmVyIGFzIGFueSk7XG4gIHJlcy5zb2NrZXQuc2VydmVyLmlvID0gaW87XG5cbiAgaW8ub24oXCJjb25uZWN0aW9uXCIsIChzb2NrZXQpID0+IHtcbiAgICBjb25zb2xlLmxvZyhgVXNlciBDb25uZWN0ZWQgOiAke3NvY2tldC5pZH1gKTtcbiAgICAvL3BlZXLqsIAgcm9vbSBqb2luIOuyhO2KvOydhCDriIzroIDsnYQg6rK97JqwIO2BtOudvOydtOyWuO2KuOyXkOyEnCBqb2lu7J20IO2KuOumrOqxsCDrkJjslrQg7ISc67KE7JeQIOyghOuLrFxuICAgIHNvY2tldC5vbihcImpvaW5cIiwgKHJvb21OYW1lKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhcIltnZXQgZXZlbnRdXCIpO1xuICAgICAgY29uc3QgeyByb29tcyB9ID0gaW8uc29ja2V0cy5hZGFwdGVyO1xuICAgICAgY29uc3Qgcm9vbSA9IHJvb21zLmdldChyb29tTmFtZSk7XG4gICAgICAvL+uwqeydtCDsl4bripQg6rK97JqwXG4gICAgICBpZiAocm9vbSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiW2VtaXQgY3JlYXRlXVwiKTtcbiAgICAgICAgc29ja2V0LmpvaW4ocm9vbU5hbWUpO1xuICAgICAgICBzb2NrZXQuZW1pdChcImNyZWF0ZWRcIik7XG4gICAgICB9IGVsc2UgaWYgKHJvb20uc2l6ZSA9PT0gMSkge1xuICAgICAgICAvL+uwqeyXkCDtlZwg66qF66eMIOyeiOydhCDqsr3smrBcbiAgICAgICAgY29uc29sZS5sb2coXCJbZW1pdCBqb2luZWRdXCIpO1xuICAgICAgICBzb2NrZXQuam9pbihyb29tTmFtZSk7XG4gICAgICAgIHNvY2tldC5lbWl0KFwiam9pbmVkXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy/rsKnsl5Ag65GQ66qF7J24IOqyveyasCAoZnVsbClcbiAgICAgICAgY29uc29sZS5sb2coXCJbZW1pdCBmdWxsXVwiKTtcbiAgICAgICAgc29ja2V0LmVtaXQoXCJmdWxsXCIpO1xuICAgICAgfVxuICAgICAgY29uc29sZS5sb2coXCJyb29tIGluZm8gOiBcIiwgcm9vbXMpO1xuICAgIH0pO1xuICAgIC8v67Cp7JeQIOywuOyXrO2VnCDsgqzrnozsnbQgY29ubmVjdGlvbiDspIDruYTqsIAg65CY66m0IHJlYWR56rCAIO2KuOumrOqxsCDrkKhcbiAgICBzb2NrZXQub24oXCJyZWFkeVwiLCAocm9vbU5hbWUpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKFwiW2VtaXQgcmVhZHldXCIpO1xuICAgICAgc29ja2V0LmJyb2FkY2FzdC50byhyb29tTmFtZSkuZW1pdChcInJlYWR5XCIpO1xuICAgIH0pO1xuICAgIC8v7ISc67KE6rCAIHJvb23snZggcGVlcuuhnOu2gO2EsCBcImljZWNhbmRpZGF0ZVwi66W8IOuwm+ydhCDrlYwg7Yq466as6rGwXG4gICAgc29ja2V0Lm9uKFwiaWNlLWNhbmRpZGF0ZVwiLCAoY2FuZGlkYXRlLCByb29tTmFtZSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coXCJbZW1pdCBpY2UtY2FuZGlkYXRlXVwiKTtcbiAgICAgIHNvY2tldC5icm9hZGNhc3QudG8ocm9vbU5hbWUpLmVtaXQoXCJpY2UtY2FuZGlkYXRlXCIsIGNhbmRpZGF0ZSk7IC8vIHJvb23sl5Ag7J6I64qUIOuLpOuluCBwZWVy7JeQ6rKMIFwiY2FuZGlkYXRlXCIgZW1pdFxuICAgIH0pO1xuICAgIC8v7ISc67KE6rCAIHJvb23sl5Ag7J6I64qUIHBlZXLroZzrtoDthLAgXCJvZmZlclwi66W8IOuwm+ydhCDrlYwg7Yq466as6rGwXG4gICAgc29ja2V0Lm9uKFwib2ZmZXJcIiwgKG9mZmVyLCByb29tTmFtZSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coXCJbZW1pdCBvZmZlcl1cIik7XG4gICAgICBzb2NrZXQuYnJvYWRjYXN0LnRvKHJvb21OYW1lKS5lbWl0KFwib2ZmZXJcIiwgb2ZmZXIpOyAvLyByb29t7JeQIOyeiOuKlCDri6TrpbggcGVlcuyXkOqyjCBcIm9mZmVyXCIgZW1pdFxuICAgIH0pO1xuICAgIC8v7ISc67KE6rCAIHJvb23sl5Ag7J6I64qUIHBlZXLroZzrtoDthLAgXCJhbnN3ZXJcIuulvCDrsJvsnYQg65WMIO2KuOumrOqxsFxuICAgIHNvY2tldC5vbihcImFuc3dlclwiLCAoYW5zd2VyLCByb29tTmFtZSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coXCJbZW1pdCBhbnN3ZXJdXCIpO1xuICAgICAgc29ja2V0LmJyb2FkY2FzdC50byhyb29tTmFtZSkuZW1pdChcImFuc3dlclwiLCBhbnN3ZXIpOyAvLyByb29t7JeQIOyeiOuKlCDri6TrpbggcGVlcuyXkOqyjCBcImFuc3dlclwiIGVtaXRcbiAgICB9KTtcbiAgICAvL+yEnOuyhOqwgCByb29t7JeQIOyeiOuKlCBwZWVy66Gc67aA7YSwIFwibGVhdmVcIuulvCDrsJvsnYQg65WMIO2KuOumrOqxsFxuICAgIHNvY2tldC5vbihcImxlYXZlXCIsIChyb29tTmFtZSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coXCJbZW1pdCBsZWF2ZV1cIiwgcm9vbU5hbWUpO1xuICAgICAgc29ja2V0LmxlYXZlKHJvb21OYW1lKTtcbiAgICAgIHNvY2tldC5icm9hZGNhc3QudG8ocm9vbU5hbWUpLmVtaXQoXCJsZWF2ZVwiKTsgLy8gcm9vbeyXkCDsnojripQg64uk66W4IHBlZXLsl5DqsowgXCJsZWF2ZVwiIGVtaXRcbiAgICB9KTtcbiAgfSk7XG4gIHJldHVybiByZXMuZW5kKCk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBTb2NrZXRIYW5kbGVyO1xuIl0sIm5hbWVzIjpbIlNlcnZlciIsIlNvY2tldElPU2VydmVyIiwiU29ja2V0SGFuZGxlciIsIl8iLCJyZXMiLCJzb2NrZXQiLCJzZXJ2ZXIiLCJpbyIsImNvbnNvbGUiLCJsb2ciLCJlbmQiLCJvbiIsImlkIiwicm9vbU5hbWUiLCJyb29tcyIsInNvY2tldHMiLCJhZGFwdGVyIiwicm9vbSIsImdldCIsInVuZGVmaW5lZCIsImpvaW4iLCJlbWl0Iiwic2l6ZSIsImJyb2FkY2FzdCIsInRvIiwiY2FuZGlkYXRlIiwib2ZmZXIiLCJhbnN3ZXIiLCJsZWF2ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/webRTC/socket.tsx\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/webRTC/socket.tsx"));
module.exports = __webpack_exports__;

})();